<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="adminevent">
	
<!-- 회원리스트 -->
<select id="getEventList" parameterType="com.rhymes.app.event.model.EventParam" resultType="com.rhymes.app.event.model.EventDTO">
	SELECT SEQ, TITLE, TYPE, date_format(RDATE, "%Y-%m-%d") AS RDATE, SDATE, EDATE, VISIBLE
       FROM (SELECT ROW_NUMBER()OVER(ORDER BY #{sorting} DESC)AS RNUM,
				SEQ, TITLE, TYPE, RDATE, SDATE, EDATE, VISIBLE
			FROM rhy_event_list
			WHERE 1=1
			<if test="s_category != null and s_category != ''">
				<if test="s_keyword != null and s_keyword != ''">
					<if test="s_category == '01'">
						AND TITLE LIKE '%' #{s_keyword} '%'
					</if>
					<if test="s_category == '02'">
						AND TYPE LIKE '%' #{s_keyword} '%'
					</if>
					<if test="s_category == '03'">
						AND SDATE LIKE '%' #{s_keyword} '%'
					</if>
					<if test="s_category == '04'">
						AND EDATE LIKE '%' #{s_keyword} '%'
					</if>
					<if test="s_category == '05'">
						AND RDATE LIKE '%' #{s_keyword} '%'
					</if>
				</if>
			</if>
				)B
		WHERE RNUM BETWEEN ${start} AND ${end}
		ORDER BY #{sorting} DESC
</select>

<!-- 회원 리스트 count -->
<select id="getEventCount" parameterType="com.rhymes.app.event.model.EventParam" resultType="java.lang.Integer">
	SELECT IFNULL(COUNT(*), 0) AS CNT
	FROM rhy_event_list
	WHERE 1=1
		<if test="s_category != null and s_category != ''
						and s_keyword != null and s_keyword != ''">
			<if test="s_category == '01'">
					AND TITLE LIKE '%' #{s_keyword} '%'
				</if>
				<if test="s_category == '02'">
					AND TYPE LIKE '%' #{s_keyword} '%'
				</if>
				<if test="s_category == '03'">
					AND RDATE LIKE '%' #{s_keyword} '%'
				</if>
				<if test="s_category == '04'">
					AND SDATE LIKE '%' #{s_keyword} '%'
				</if>
				<if test="s_category == '05'">
					AND EDATE LIKE '%' #{s_keyword} '%'
				</if>					
		</if>
</select>

<!-- 이벤트 글 작성 -->
<insert id="geteventwrite" parameterType="com.rhymes.app.event.model.EventDTO">
	INSERT INTO RHY_EVENT_LIST(TITLE, TYPE, PHOTO_BANNER, PHOTO_BANNER_SYS, PHOTO_FILE, SDATE, EDATE, VISIBLE)
	VALUES(#{title}, #{type}, #{photo_banner}, #{photo_banner_sys}, #{photo_file}, #{sdate}, #{edate}, 1)
	
</insert>
	













</mapper>