<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="MyUsed">
<!-- 아이디 조회 -->
<select id="getMemberid" resultType="java.lang.String" parameterType="java.lang.String">
	SELECT id 
	FROM rhy_mem_p
	WHERE ID LIKE CONCAT('%',#{value},'%')
	AND subscribe = 0
	AND id not in(#{id})
	ORDER BY CHAR_LENGTH(id)
</select>

<select id="getsendnotes" parameterType="java.lang.String" resultType="com.rhymes.app.used.model.NotesDto">
	SELECT *
	FROM rhy_used_notes
	WHERE recv_id=#{name}
</select>

<select id="getrecvnotes" parameterType="java.lang.String" resultType="com.rhymes.app.used.model.NotesDto">
	SELECT *
	FROM rhy_used_notes
	WHERE send_id=#{name}
</select>


<select id="getsubscribe" resultType="java.lang.Integer"> <!-- 수신 여부 조회 -->
	SELECT subscribe
	FROM rhy_mem_p
	WHERE id=#{id}
</select>

<update id="deletesubscribe"> <!-- 수신 설정 -->
 	UPDATE rhy_mem_p
 	SET subscribe = 0
 	WHERE id=#{id}
</update>

<update id="addsubscribe">	<!-- 수신거부 설정 -->
 	UPDATE rhy_mem_p
 	SET subscribe = 1
 	WHERE id=#{id}
</update>

<select id="idcheck" parameterType="java.lang.String" resultType="java.lang.Integer"> <!-- 실시간 아이디 체크 -->
	SELECT COUNT(*)
	FROM rhy_mem_p
	WHERE ID=#{id}
	AND subscribe = 0
</select>

<!-- 쪽지 발송  -->
<insert id="sendnotes" parameterType="com.rhymes.app.used.model.NotesDto">
	INSERT INTO rhy_used_notes(send_id,recv_id,content,data_send,send_del,recv_del)
	VALUES(#{send_id},#{recv_id},#{content},NOW(),#{send_del},'N')
</insert>

<!-- 쪽지 디테일 -->
<select id="getnotesdetail" parameterType="java.lang.String" resultType="com.rhymes.app.used.model.NotesDto">
	SELECT *
	FROM rhy_used_notes
	WHERE SEQ=#{seq}
</select>

<!-- 쪽지 삭제 -->
<update id="notesdelete" parameterType="com.rhymes.app.used.model.NotesDto">
	UPDATE rhy_used_notes
	SET send_del = 'Y'
	WHERE recv_id=#{recv_id}
	AND send_id=#{send_id}
	AND seq=#{seq}
</update>
<!-- 쪽지 삭제 -->
<update id="notesdelete2" parameterType="com.rhymes.app.used.model.NotesDto">
	UPDATE rhy_used_notes
	SET recv_del = 'Y'
	WHERE recv_id=#{recv_id}
	AND send_id=#{send_id}
	AND seq=#{seq}
</update>

</mapper> 