<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="adminCompanyPayment">

<!-- 관리자페이지 결제내역조회 -->
<select id="getOrderSuccessList" parameterType="com.rhymes.app.admin.payment.model.AdminPaymentParam" resultType="com.rhymes.app.payment.model.PaymentDTO">
SELECT PAYMENT_CODE, USERID, SEND_NAME, COUPON_CODE, PAYMENT_METHOD, PAYMENT_STATUS, TOTALPRICE, RDATE
FROM
	(SELECT ROW_NUMBER()OVER(ORDER BY P.RDATE DESC) AS RNUM, P.PAYMENT_CODE, P.USERID, P.SEND_NAME, P.COUPON_CODE, P.PAYMENT_METHOD, P.PAYMENT_STATUS, P.TOTALPRICE, P.RDATE
	FROM RHY_PAYMENT P, RHY_PAYMENT_DETAILS PD, RHY_STORE_STOCK SS, RHY_STORE_PRODUCT SP, RHY_MEM_C MC
	WHERE P.PAYMENT_CODE=PD.PAYMENT_CODE AND PD.S_SEQ=SS.STOCK_SEQ AND SS.P_SEQ=SP.P_SEQ AND SP.C_NAME=MC.C_NAME AND MC.ID=#{userid}
		<if test="s_category != null and s_category != ''">
			<if test="s_category == 'id'">
				AND USERID LIKE '%' #{s_category} '%'
			</if>
			<if test="s_category == 'name'">
				AND SEND_NAME LIKE '%' #{s_category} '%'
			</if>
			<if test="s_category == 'payment_method'">
				AND PAYMENT_METHOD LIKE '%' #{s_category} '%'
			</if>
			<if test="s_category == 'payment_status'">
				AND PAYMENT_STATUS LIKE '%' #{s_category} '%'
			</if>
		</if>
	ORDER BY P.RDATE DESC
	) B
WHERE RNUM BETWEEN ${start} AND ${end}
ORDER BY RDATE DESC
</select>

<!-- 관리자페이지 결제상내역 총 개수 -->
<select id="getOrderSuccessCount" parameterType="com.rhymes.app.admin.payment.model.AdminPaymentParam" resultType="java.lang.Integer">
SELECT IFNULL(COUNT(*), 0)
FROM RHY_PAYMENT
WHERE 1=1
	<if test="s_category != null and s_category != ''">
		<if test="s_category == 'id'">
			AND USERID LIKE '%' #{s_category} '%'
		</if>
		<if test="s_category == 'name'">
			AND SEND_NAME LIKE '%' #{s_category} '%'
		</if>
		<if test="s_category == 'payment_method'">
			AND PAYMENT_METHOD LIKE '%' #{s_category} '%'
		</if>
		<if test="s_category == 'payment_status'">
			AND PAYMENT_STATUS LIKE '%' #{s_category} '%'
		</if>
	</if>
</select>

</mapper>

