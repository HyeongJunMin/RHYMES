<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="admem">

	<!-- memlist 검색 페이징 -->
	<select id="getmemlist" parameterType="com.rhymes.app.member.model.MemberParam" resultType="com.rhymes.app.member.model.MemBean">
		SELECT SEQ, ID AS USERID, RDATE, SOCIAL, NAME AS USERNAME, POSTCODE, ADDRESS, DETAILADDRESS, 
				EMAIL AS USEREMAIL, PHONE, GENDER, BIRTH, AUTHORITY
	       FROM (SELECT ROW_NUMBER()OVER(ORDER BY M.SEQ DESC)AS RNUM,
					M.SEQ, M.ID, M.RDATE, M.SOCIAL, P.NAME, P.POSTCODE, P.ADDRESS, P.DETAILADDRESS, 
					P.EMAIL, P.PHONE, P.GENDER, P.BIRTH, A.AUTHORITY
					FROM RHY_MEM M, RHY_MEM_P P, AUTHORITIES A
					WHERE 1=1 
					<if test="s_category != null and s_category != ''">
						<if test="s_keyword != null and s_keyword != ''">
							<if test="s_category == '01'">
								AND M.ID LIKE '%' #{s_keyword} '%'
							</if>
							<if test="s_category == '02'">
								AND P.EMAIL LIKE '%' #{s_keyword} '%'
							</if>
							<if test="s_category == '03'">
								AND M.SOCIAL LIKE '%' #{s_keyword} '%'
							</if>
							<if test="s_category == '04'">
								AND P.PHONE LIKE '%' #{s_keyword} '%''
							</if>
						</if>
					</if>
					AND M.ID = P.ID AND P.ID = A.ID
					)B
			WHERE RNUM BETWEEN ${start} AND ${end}	
			ORDER BY SEQ DESC
	</select>
	

	<!-- list 총 수 -->
	<select id="getmemCount" parameterType="com.rhymes.app.member.model.MemberParam"
		resultType="java.lang.Integer">
		SELECT IFNULL(COUNT(*), 0) AS CNT
		FROM RHY_MEM M, RHY_MEM_P P, AUTHORITIES A
		WHERE 1=1
			<if test="s_category != null and s_category != ''
							and s_keyword != null and s_keyword != ''">
						
				<if test="s_category == '01'">
					AND M.ID LIKE '%' #{s_keyword} '%'
				</if>
				<if test="s_category == '02'">
					AND P.EMAIL LIKE '%' #{s_keyword} '%'
				</if>
				<if test="s_category == '03'">
					AND M.SOCIAL LIKE '%' #{s_keyword} '%'
				</if>
				<if test="s_category == '04'">
					AND P.PHONE '%' #{s_keyword} '%'
				</if>
					AND M.ID = P.ID AND P.ID = A.ID
			</if>
	</select>


</mapper>