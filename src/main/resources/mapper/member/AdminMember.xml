<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="admem">
	
	<!-- 회원리스트 -->
	<select id="getmemlist" parameterType="com.rhymes.app.member.model.MemberParam" resultType="com.rhymes.app.member.model.MemBean">
		SELECT SEQ, ID AS USERID, RDATE, SOCIAL, NAME AS USERNAME, POSTCODE, ADDRESS, DETAILADDRESS, 
				EMAIL AS USEREMAIL, PHONE, GENDER, BIRTH, AUTHORITY
	       FROM (SELECT ROW_NUMBER()OVER(ORDER BY #{sorting} DESC)AS RNUM,
					M.SEQ, M.ID, M.RDATE, M.SOCIAL, P.NAME, P.POSTCODE, P.ADDRESS, P.DETAILADDRESS, 
					P.EMAIL, P.PHONE, P.GENDER, P.BIRTH, A.AUTHORITY
				FROM RHY_MEM M, RHY_MEM_P P, AUTHORITIES A
				WHERE M.ID = P.ID AND P.ID = A.ID 
				<if test="s_category != null and s_category != ''">
					<if test="s_keyword != null and s_keyword != ''">
						<if test="s_category == '01'">
							AND M.ID LIKE '%' #{s_keyword} '%'
						</if>
						<if test="s_category == '02'">
							AND P.EMAIL LIKE '%' #{s_keyword} '%'
						</if>
						<if test="s_category == '03'">
							AND M.SOCIAL LIKE '%' #{s_keyword} '%'
						</if>
						<if test="s_category == '04'">
							AND P.PHONE LIKE '%' #{s_keyword} '%'
						</if>
					</if>
				</if>
					
					)B
			WHERE RNUM BETWEEN ${start} AND ${end}	
			ORDER BY #{sorting} DESC
	</select>

	<!-- 회원 리스트 count -->
	<select id="getmemCount" parameterType="com.rhymes.app.member.model.MemberParam"
		resultType="java.lang.Integer">
		SELECT IFNULL(COUNT(*), 0) AS CNT
		FROM RHY_MEM M, RHY_MEM_P P, AUTHORITIES A
		WHERE M.ID = P.ID AND P.ID = A.ID
			<if test="s_category != null and s_category != ''
							and s_keyword != null and s_keyword != ''">
						
				<if test="s_category == '01'">
					AND M.ID LIKE '%' #{s_keyword} '%'
				</if>
				<if test="s_category == '02'">
					AND P.EMAIL LIKE '%' #{s_keyword} '%'
				</if>
				<if test="s_category == '03'">
					AND M.SOCIAL LIKE '%' #{s_keyword} '%'
				</if>
				<if test="s_category == '04'">
					AND P.PHONE '%' #{s_keyword} '%'
				</if>
					
			</if>
	</select>

	<!-- 업체 리스트 -->
	<select id="getmem_c_list" parameterType="com.rhymes.app.member.model.MemberParam" resultType="com.rhymes.app.member.model.SellerBean">
	SELECT SEQ, ID AS USERID, RDATE, SOCIAL, C_NAME, C_NUM, P_NAME, C_POSTCODE, C_ADDRESS, C_DETAILADDRESS
			IC_NAME, IC_PHONE, IC_EMAIL, AUTHORITY
       FROM (SELECT ROW_NUMBER()OVER(ORDER BY M.SEQ DESC)AS RNUM,
				M.SEQ, M.ID, M.RDATE, M.SOCIAL, C.C_NAME, C.C_NUM, C.P_NAME, C.C_POSTCODE, C.C_ADDRESS, C.C_DETAILADDRESS,
				C.IC_NAME, C.IC_PHONE, C.IC_EMAIL, A.AUTHORITY
			FROM RHY_MEM M, RHY_MEM_C C, AUTHORITIES A
			WHERE M.ID = C.ID AND C.ID = A.ID 
			<if test="s_category != null and s_category != ''">
				<if test="s_keyword != null and s_keyword != ''">
					<if test="s_category == '01'">
						AND M.ID LIKE '%' #{s_keyword} '%'
					</if>
					<if test="s_category == '02'">
						AND C.C_NAME LIKE '%' #{s_keyword} '%'
					</if>
					<if test="s_category == '03'">
						AND C.C_NUM LIKE '%' #{s_keyword} '%'
					</if>
					<if test="s_category == '04'">
						AND C.IC_NAME LIKE '%' #{s_keyword} '%'
					</if>
					<if test="s_category == '05'">
						AND C.IC_PHONE LIKE '%' #{s_keyword} '%'
					</if>
				</if>
			</if>
				
				)B
		WHERE RNUM BETWEEN ${start} AND ${end}	
		ORDER BY #{sorting} DESC
	</select>
	
	<!-- 업체 리스트 count -->
	 <select id="getmem_c_Count" parameterType="com.rhymes.app.member.model.MemberParam"
	resultType="java.lang.Integer">
	SELECT IFNULL(COUNT(*), 0) AS CNT
	FROM RHY_MEM M, RHY_MEM_C C, AUTHORITIES A
	WHERE M.ID = C.ID AND C.ID = A.ID
		<if test="s_category != null and s_category != ''
						and s_keyword != null and s_keyword != ''">
						
			<if test="s_category == '01'">
				AND M.ID LIKE '%' #{s_keyword} '%'
			</if>		
			<if test="s_category == '02'">
				AND C.C_NAME LIKE '%' #{s_keyword} '%'
			</if>
			<if test="s_category == '03'">
				AND C.C_NUM LIKE '%' #{s_keyword} '%'
			</if>
			<if test="s_category == '04'">
				AND C.IC_NAME LIKE '%' #{s_keyword} '%'
			</if>
			<if test="s_category == '05'">
				AND C.IC_PHONE LIKE '%' #{s_keyword} '%'
			</if>
				
		</if>
	</select> 
	
	

	<!-- 회원정보 불러오기 -->
	<select id="getAdMem" parameterType="java.lang.String" resultType="com.rhymes.app.member.model.P_MemberDTO">
		SELECT SEQ, ID AS USERID, NAME AS USERNAME, POSTCODE, ADDRESS, DETAILADDRESS, EMAIL AS USEREMAIL, PHONE, GENDER AS USERGENDER, BIRTH AS USERBIRTH
		FROM RHY_MEM_P
		WHERE ID=#{id}
	</select>
	
	<!-- 회원정보 수정 -->
	<update id="getAdMemAf" parameterType="com.rhymes.app.member.model.P_MemberDTO">
		UPDATE RHY_MEM_P
		SET NAME=#{username}, POSTCODE=#{postcode}, ADDRESS=#{address}, DETAILADDRESS=#{detailAddress}, 
			EMAIL=#{useremail}, PHONE=#{phone}, GENDER=#{usergender}, BIRTH=#{userbirth}
		WHERE ID=#{userid}
	</update>















</mapper>