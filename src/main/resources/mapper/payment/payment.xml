<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="payment">

<!-- 장바구니에서 주문페이지로 갈 때 -->

<!-- 장바구니에서 주문한 상품정보 가져오기 -->
<select id="getOrder" parameterType="com.rhymes.app.payment.model.OrderDTO"
resultType="com.rhymes.app.payment.model.OrderDTO">
SELECT P.C_NAME, P.P_NAME, P.P_PRICE, P.PHOTO1_FILE, S.STOCK_SEQ
FROM RHY_STORE_PRODUCT P, RHY_STORE_STOCK S
WHERE P.P_SEQ = S.P_SEQ
AND STOCK_SEQ=#{stock_seq}
</select>

<!-- 주문페이지로 적립금 가져오기 -->
<select id="getPoint" parameterType="java.lang.String">
SELECT AMOUNT
FROM RHY_MEM_POINT
WHERE id=#${id}
</select>

<!-- 주문페이지로 쿠폰 가져오기 -->
<select id="getCoupon" parameterType="java.lang.String">
SELECT 
FROM RHY_MEM_COUPON C1, RHY_MEM_COUPON_DETAIL C2
WHERE id=#{id}
</select>





<!-- 주문페이지에서 주문완료 후 -->

<!-- 주문한 상품의 재고 수량 차감 -->
<select id="product_count" parameterType="com.rhymes.app.payment.model.OrderDTO">
UPDATE RHY_STORE_STOCK
SET QUANTITY = QUANTITY - 1
WHERE STOCK_SEQ=#{stock_seq}
</select>

<!-- 이메일로 결제내역을 보낸다 -->
<!-- 적립금 차감한다 -->
<!-- 사용한 쿠폰을 지운다 -->
<!-- 주문한 상품수량만큼 재고수량에서 차감한다 -->
<!-- 결제내역 저장 -->







<!-- 비회원으로 주문내역 있는지 확인 -->
<select id="no_member_confirm" parameterType="com.rhymes.app.payment.model.PaymentDTO"
resultType="java.lang.String">
SELECT SEND_NAME
FROM RHY_PAYMENT
WHERE SEND_NAME=#{send_name } AND PAYMENT_CODE=#{payment_code }
</select>

<!-- 주문내역 조회 -->
<select id="getOrdercheck" resultType="com.rhymes.app.payment.model.PaymentDTO">
SELECT * FROM RHY_PAYMENT
ORDER BY RDATE DESC
</select>

<!-- 주문상세내역 조회 -->
<select id="getOrdercheckDetail" parameterType="java.lang.String" resultType="com.rhymes.app.payment.model.PaymentDTO">
SELECT * FROM RHY_PAYMENT
WHERE PAYMENT_CODE=#{payment_code}
ORDER BY RDATE DESC
</select>

<!-- 배송현황 조회 -->
<select id="getOrdercheckDelivery" parameterType="java.lang.String" resultType="com.rhymes.app.payment.model.DeliveryDTO">
SELECT * FROM RHY_DELIVERY
WHERE payment_code=#{payment_code}
</select>


</mapper>
